name: Automated seismological vizualisation 
on:
  # Schedule updates (each 15 minutes)
  schedule: [{cron: "*/15 * * * *"}]
  # Lines below let you run workflow manually and on each commit
  workflow_dispatch:
  push: {branches: ["master", "main"]}
jobs:
  Viz-EEW-UNA:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v3
      - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }} 
      - name: Install python dependencies
        run: |
          python -m pip install --requirement ${{ github.workspace }}/requirements.txt
      - name: Run the main program
        run: |
          python ${{ github.workspace }}/seismo-viz.py catalog_uri='USGS',${{ secrets.UNA_EEW_URL }} minmagnitude=4 longitude=-84 latitude=9.5 maxradius=3 debug=1
      - name: Archive all data and visuals in workspace
        uses: actions/upload-artifact@v3
        id: archive
        with:
          name: Data-and-Vizuals-UNA
          path: |
            ${{ github.workspace }}/data/*ml
            ${{ github.workspace }}/data/*seed
            ${{ github.workspace }}/*.png 
            ${{ github.workspace }}/*.mp4
          retention-days: 1
      - run: echo "ğŸ The visuals from ${{ github.workspace }} are archived as an artifact for 1 days."
      - run: echo "ğŸ This job's status is ${{ job.status }}."
